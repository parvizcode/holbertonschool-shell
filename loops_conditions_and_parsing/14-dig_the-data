#!/usr/bin/env bash
# Apache log dosyasını IP ve HTTP durum koduna göre gruplayıp sıralar

# Log dosyasının varlığını ve boş olmadığını kontrol et
if [ ! -f "apache-access.log" ] || [ ! -s "apache-access.log" ]; then
    exit 0
fi

# AWK kullanarak log dosyasını işle (ShellCheck uyarılarını önleyecek şekilde)
awk '
    BEGIN {
        # AWK içinde değişkenleri başlat
        delete count
    }
    {
        # Her IP+status kombinasyonunu say
        kombinasyon = $1 " " $9
        count[kombinasyon]++
    }
    END {
        # Sayımları büyükten küçüğe sırala
        for (k in count) {
            print count[k], k
        }
    }
' apache-access.log | sort -k1,1nr -k2,2
